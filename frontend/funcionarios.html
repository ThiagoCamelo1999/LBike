<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funcion치rios - LBike</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Cabe칞alho com logo e navega칞칚o -->
    <header class="header">
        <div class="logo">
            <a href="index.html">
                <img src="./logo.png" alt="Logotipo LBike">
            </a>
        </div>
        <nav class="navbar">
            <ul>
                <li><a href="agendamentos.html">Agendamentos</a></li>
                <li><a href="items.html">Estoque</a></li>
                <li><a href="loja.html">Loja</a></li>
                <li><a href="pedidos.html">Pedidos</a></li>
                <button id="logoutButton" class="logout-btn">Sair</button>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Bot칚o para exibir o formul치rio de cria칞칚o -->
        <button id="toggleFormButton">Criar Funcion치rio</button>

        <!-- Formul치rio para cria칞칚o de funcion치rio -->
        <div id="formContainer" style="display: none;">
            <h2>Criar Funcion치rio</h2>
            <form id="funcionarioForm">
                <input type="text" name="nome" placeholder="Nome" required>
                <input type="text" name="cpf" placeholder="CPF" required>
                <input type="text" name="telefone" placeholder="Telefone" required>
                <input type="text" name="endereco" placeholder="Endere칞o" required>
                <input type="number" name="dias_trabalhados" placeholder="Dias Trabalhados" required>
                <input type="number" name="valor_pago" placeholder="Valor Pago" required>
                <button type="submit">Criar Funcion치rio</button>
            </form>
        </div>

        <!-- Lista de funcion치rios cadastrados -->
        <h2>Lista de Funcion치rios</h2>
        <ul id="funcList">
            <li class="list-header">
                <span>Nome</span>
                <span>CPF</span>
                <span>Telefone</span>
                <span>Endere칞o</span>
                <span>Dias Trabalhados</span>
                <span>Valor Pago</span>
            </li>
            <ul id="funcionarioList"></ul>
        </ul>

        <!-- Formul치rio para edi칞칚o de funcion치rios -->
        <div id="editFormContainer" style="display: none;">
            <h2>Editar Funcion치rio</h2>
            <form id="editFuncionarioForm">
                <input type="text" name="nome" placeholder="Nome" required>
                <input type="text" name="cpf" placeholder="CPF" required>
                <input type="text" name="telefone" placeholder="Telefone" required>
                <input type="text" name="endereco" placeholder="Endere칞o" required>
                <input type="number" name="dias_trabalhados" placeholder="Dias Trabalhados" required>
                <input type="number" name="valor_pago" placeholder="Valor Pago" required>
                <button type="submit">Salvar Altera칞칫es</button>
            </form>
        </div>
    </main>

    <!-- Rodap칠 com informa칞칫es de direitos autorais -->
    <footer>
        <p>&copy; 2024 LBike. Todos os direitos reservados.</p>
    </footer>

    <!-- Scripts para interatividade -->
    <script src="scripts.js"></script>
    <script>
        // Fun칞칚o para carregar a lista de funcion치rios
        async function loadFuncionarios() {
            const funcionarioList = document.getElementById('funcionarioList');

            // Limpa a lista antes de carreg치-la novamente
            funcionarioList.innerHTML = '';

            try {
                const funcionarios = await getAllResources('funcionarios');

                // Adiciona cada funcion치rio na lista
                funcionarios.forEach(item => {
                    const li = document.createElement('li');
                    li.classList.add('list-item');
                    li.innerHTML = `
                        <span>${item.nome}</span>
                        <span>${item.cpf}</span>
                        <span>${item.telefone}</span>
                        <span>${item.endereco}</span>
                        <span>${item.dias_trabalhados}</span>
                        <span>R$${item.valor_pago.toFixed(2)}</span>
                        <button onclick="editFuncionario(${item.id})">Editar</button>
                        <button onclick="deleteFuncionario(${item.id})">Excluir</button>
                    `;
                    funcionarioList.appendChild(li);
                });
            } catch (error) {
                alert('Erro ao carregar funcion치rios: ' + error.message);
            }
        }

        // Fun칞칚o para excluir um funcion치rio
        async function deleteFuncionario(funcionarioId) {
            const confirmation = confirm("Tem certeza que deseja excluir este funcion치rio?");
            if (!confirmation) return;

            try {
                await fetch(`http://localhost:3000/api/funcionarios/${funcionarioId}`, {
                    method: 'DELETE',
                });
                alert('Funcion치rio exclu칤do com sucesso');
                loadFuncionarios();
            } catch (error) {
                alert('Erro ao excluir funcion치rio: ' + error.message);
            }
        }

        // Fun칞칚o para preparar a edi칞칚o de um funcion치rio
        let editingFuncionarioId = null;
        async function editFuncionario(funcionarioId) {
            editingFuncionarioId = funcionarioId;

            try {
                const funcionario = await getResourceById(`funcionarios/${funcionarioId}`);

                // Preenche o formul치rio de edi칞칚o
                const editForm = document.getElementById('editFuncionarioForm');
                Object.keys(funcionario).forEach(key => {
                    const input = editForm.querySelector(`[name=${key}]`);
                    if (input) input.value = funcionario[key];
                });

                document.getElementById('editFormContainer').style.display = 'block';
            } catch (error) {
                alert('Erro ao carregar dados do funcion치rio: ' + error.message);
            }
        }

        // Submiss칚o do formul치rio de edi칞칚o
        document.getElementById('editFuncionarioForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target).entries());

            try {
                await updateResource(`funcionarios/${editingFuncionarioId}`, data);
                alert('Funcion치rio atualizado com sucesso');
                document.getElementById('editFormContainer').style.display = 'none';
                loadFuncionarios();
            } catch (error) {
                alert('Erro ao salvar altera칞칫es: ' + error.message);
            }
        });

        // Inicializa칞칚o de eventos da p치gina
        document.addEventListener('DOMContentLoaded', () => {
            const toggleFormButton = document.getElementById('toggleFormButton');
            const formContainer = document.getElementById('formContainer');

            toggleFormButton.addEventListener('click', () => {
                const isHidden = formContainer.style.display === 'none' || !formContainer.style.display;
                formContainer.style.display = isHidden ? 'block' : 'none';
                toggleFormButton.textContent = isHidden ? 'Cancelar' : 'Criar Funcion치rio';
            });

            initEvents(); // Chama inicializa칞칚o dos eventos
        });

        // Fun칞칚o para configurar os eventos iniciais
        function initEvents() {
            const funcionarioForm = document.getElementById('funcionarioForm');

            funcionarioForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const data = Object.fromEntries(new FormData(funcionarioForm).entries());

                try {
                    await createResource('funcionarios', data);
                    funcionarioForm.reset();
                    loadFuncionarios();
                } catch (error) {
                    alert('Erro ao criar funcion치rio: ' + error.message);
                }
            });

            loadFuncionarios(); // Carrega a lista inicial de funcion치rios
        }

        document.addEventListener("DOMContentLoaded", () => {
            const tipo_usuario = localStorage.getItem("tipo_usuario");

            if (tipo_usuario !== "dono") {
                window.location.href = "index.html"; // 游댳 Redireciona clientes para a p치gina inicial
            }
        });

        document.getElementById("logoutButton").addEventListener("click", () => {
    localStorage.clear(); // 游댳 Remove todos os dados do usu치rio
    window.location.replace("login.html"); // 游댳 Usa replace() para evitar voltar para a p치gina anterior
});

    </script>
</body>

</html>