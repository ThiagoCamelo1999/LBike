<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Itens - LBike</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Cabe칞alho com o logo e menu de navega칞칚o -->
    <header class="header">
        <div class="logo">
            <a href="index.html">
                <img src="./logo.png" alt="Logo da LBike">
            </a>
        </div>
        <nav class="navbar">
            <ul>
                <li><a href="agendamentos.html">Agendamentos</a></li>
                <li><a href="funcionarios.html">Funcion치rios</a></li>
                <li><a href="loja.html">Loja</a></li>
                <li><a href="pedidos.html">Pedidos</a></li>
                <button id="logoutButton" class="logout-btn">Sair</button>


            </ul>
        </nav>
    </header>

    <!-- Conte칰do principal -->
    <main>
        <!-- Bot칚o para exibir/esconder formul치rio de cria칞칚o de itens -->
        <button id="toggleFormButton">Criar Item</button>

        <!-- Formul치rio de cria칞칚o de itens -->
        <div id="formContainer" style="display: none;">
            <h2>Criar Item</h2>
            <form id="itemForm">
                <input type="text" name="nome" placeholder="Nome do Item" required>
                <input type="text" name="tipo" placeholder="Tipo" required>
                <input type="text" name="marca" placeholder="Marca" required>
                <input type="number" name="quantidade" placeholder="Quantidade" required>
                <input type="number" name="valor_unitario" placeholder="Valor Unit치rio" required>
                <input type="text" name="imagem_url" placeholder="URL da Imagem"> 
                <button type="submit">Criar Item</button>
            </form>
        </div>

        <!-- Lista de itens -->
        <h2>Lista de Itens</h2>
        <ul id="itList">
            <li class="list-header">
                <span>Nome</span>
                <span>Tipo</span>
                <span>Marca</span>
                <span>Quantidade</span>
                <span>Valor Unit치rio</span>
                <span>Valor Total</span>
                <span>A칞칫es</span>
            </li>
            <ul id="itemList"></ul>
        </ul>

        <!-- Formul치rio de edi칞칚o de itens -->
        <div id="editFormContainer" style="display: none;">
            <h2>Editar Item</h2>
            <form id="editItemForm">
                <input type="text" name="nome" placeholder="Nome do Item">
                <input type="text" name="tipo" placeholder="Tipo">
                <input type="text" name="marca" placeholder="Marca">
                <input type="number" name="quantidade" placeholder="Quantidade">
                <input type="number" name="valor_unitario" placeholder="Valor Unit치rio">
                <button type="submit">Salvar Altera칞칫es</button>
            </form>
        </div>
    </main>

    <!-- Rodap칠 -->
    <footer>
        <p>&copy; 2024 LBike. Todos os direitos reservados.</p>
    </footer>

    <!-- Scripts -->
    <script src="scripts.js"></script>
    <script>
        // Fun칞칚o para carregar itens e atualizar a lista
        async function loadItems() {
            const itemList = document.getElementById('itemList');
            if (itemList) {
                itemList.innerHTML = ''; // Limpa a lista antes de carregar

                try {
                    const items = await getAllResources('items');
                    items.forEach(item => {
                        const li = document.createElement('li');
                        li.classList.add('list-item');
                        li.innerHTML = `
                            <span>${item.nome}</span>
                            <span>${item.tipo}</span>
                            <span>${item.marca}</span>
                            <span>${item.quantidade}</span>
                            <span>R$${item.valor_unitario.toFixed(2)}</span>
                            <span>R$${item.valor_total.toFixed(2)}</span>
                            <button onclick="editItem(${item.id})">Editar</button>
                            <button onclick="deleteItem(${item.id})">Excluir</button>
                        `;
                        itemList.appendChild(li);
                    });
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        // Fun칞칚o para excluir um item
        async function deleteItem(itemId) {
            const confirmation = confirm("Tem certeza que deseja excluir este item?");
            if (!confirmation) return;

            try {
                const response = await fetch(`http://localhost:3000/api/items/${itemId}`, {
                    method: 'DELETE',
                });

                if (!response.ok) {
                    throw new Error('Erro ao excluir o item');
                }

                alert('Item exclu칤do com sucesso');
                loadItems();
            } catch (error) {
                alert(error.message);
            }
        }

        // Fun칞칚o para exibir formul치rio de edi칞칚o
        async function editItem(itemId) {
            editingItemId = itemId;
            const editFormContainer = document.getElementById('editFormContainer');
            const editItemForm = document.getElementById('editItemForm');

            try {
                const item = await getResourceById(`items/${itemId}`);

                // Preenche o formul치rio com os dados do item
                Object.keys(item).forEach(key => {
                    if (editItemForm[key]) {
                        editItemForm[key].value = item[key];
                    }
                });

                editFormContainer.style.display = 'block';
            } catch (error) {
                alert(error.message);
            }
        }

        // Inicializar eventos do formul치rio e do bot칚o de cria칞칚o
        document.addEventListener('DOMContentLoaded', () => {
            const toggleFormButton = document.getElementById('toggleFormButton');
            const formContainer = document.getElementById('formContainer');

            toggleFormButton.addEventListener('click', () => {
                if (formContainer.style.display === 'none' || formContainer.style.display === '') {
                    formContainer.style.display = 'block';
                    toggleFormButton.textContent = 'Cancelar';
                } else {
                    formContainer.style.display = 'none';
                    toggleFormButton.textContent = 'Criar Item';
                }
            });

            initEvents();
        });

        // Fun칞칚o para inicializar eventos nos formul치rios
        function initEvents() {
            const itemForm = document.getElementById('itemForm');
            const editItemForm = document.getElementById('editItemForm');

            // Evento para cria칞칚o de item
            if (itemForm) {
                itemForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const formData = new FormData(itemForm);
                    const data = Object.fromEntries(formData.entries());

                    try {
                        await createResource('items', data);
                        itemForm.reset();
                        loadItems();
                    } catch (error) {
                        alert(error.message);
                    }
                });
            }

            // Evento para edi칞칚o de item
            if (editItemForm) {
                editItemForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const formData = new FormData(editItemForm);
                    const data = Object.fromEntries(formData.entries());

                    // Remove campos vazios
                    Object.keys(data).forEach(key => {
                        if (!data[key]) delete data[key];
                    });

                    try {
                        await updateResource(`items/${editingItemId}`, data);
                        editItemForm.reset();
                        document.getElementById('editFormContainer').style.display = 'none';
                        loadItems();
                    } catch (error) {
                        alert(error.message);
                    }
                });
            }
            loadItems();
        }


document.addEventListener("DOMContentLoaded", () => {
    const tipo_usuario = localStorage.getItem("tipo_usuario");

    if (tipo_usuario !== "dono") {
        window.location.href = "index.html"; // 游댳 Redireciona clientes para a p치gina inicial
    }
});

document.getElementById("logoutButton").addEventListener("click", () => {
    localStorage.removeItem("token");       // Remove o token de autentica칞칚o
    localStorage.removeItem("tipo_usuario"); // Remove o tipo de usu치rio
    window.location.href = "login.html";     // Redireciona para a tela de login
});

document.getElementById("logoutButton").addEventListener("click", () => {
    localStorage.clear(); // 游댳 Remove todos os dados do usu치rio
    window.location.replace("login.html"); // 游댳 Usa replace() para evitar voltar para a p치gina anterior
});
    </script>
</body>

</html>
